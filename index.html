<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Table‑Soccer ELO Hub (Realtime DB)</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Base colors & fonts */
    body { background: #f3f4f6; color: #1f2937; font-family: 'Inter', sans-serif; }
    /* Tab navigation */
    .nav-btn.active { color: #1d4ed8; font-weight: 600; border-b-2 border-blue-600; }
    /* Badges */
    .badge { display:inline-block; padding:2px 6px; border-radius:4px; font-size:.75rem; margin:2px; }
    .badge.locked { background:#e5e7eb; color:#6b7280; }
    .badge.unlocked { background:#34d399; color:#065f46; }
    /* Stat tiles */
    .stat-tile { background:white; padding:1rem; border-radius:.75rem; box-shadow:0 4px 8px rgba(0,0,0,0.05); }
    /* Toast notifications */
    .toast { position: fixed; bottom: 1rem; right: 1rem; background: #111827; color: white; padding: .75rem 1.25rem; border-radius: .5rem; opacity: 0; transition: opacity .3s ease; z-index: 50; }
    .toast.show { opacity: 1; }
    /* Table styling */
    table { border-collapse: separate; border-spacing: 0; border-radius: .5rem; overflow: hidden; }
    th, td { border-bottom: 1px solid #e5e7eb; }
    thead th { background: #f9fafb; font-weight: 600; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- HEADER -->
  <header class="bg-white shadow sticky top-0 z-10">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <div class="text-2xl font-bold tracking-tight text-blue-600">Table‑Soccer ELO</div>
      <nav class="space-x-4 text-gray-600">
        <button data-target="dashboard" class="nav-btn">Dashboard</button>
        <button data-target="players" class="nav-btn">Players</button>
        <button data-target="matches" class="nav-btn">Matches</button>
        <button data-target="leaderboard" class="nav-btn">Leaderboard</button>
        <button data-target="achievements" class="nav-btn">Achievements</button>
        <button data-target="stats" class="nav-btn">Stats</button>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container mx-auto px-4 py-6 flex-grow">
    <!-- Toast container -->
    <div id="toast" class="toast"></div>

    <!-- Dashboard -->
    <section id="dashboard" class="section active">
      <h2 class="text-xl font-semibold mb-4">Dashboard</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="stat-tile">Total Players: <span id="totalPlayers">0</span></div>
        <div class="stat-tile">Matches This Week: <span id="matchesWeek">0</span></div>
        <div class="stat-tile">Average ELO: <span id="averageElo">0</span></div>
        <div class="stat-tile">Pending Achievements: <span id="pendingAch">0</span></div>
      </div>
    </section>

    <!-- Players -->
    <section id="players" class="section">
      <h2 class="text-xl font-semibold mb-4">Players</h2>
      <div class="flex space-x-2 mb-4">
        <input id="newName" class="border p-2 rounded flex-grow focus:ring focus:border-blue-300" placeholder="Name"/>
        <input id="newElo" type="number" class="border p-2 rounded w-24 focus:ring focus:border-blue-300" value="100"/>
        <button id="addPlayer" class="bg-blue-600 text-white px-4 rounded hover:bg-blue-700 transition">Add</button>
      </div>
      <input id="playerSearch" class="border p-2 rounded mb-4 w-full focus:ring focus:border-blue-300" placeholder="Search..."/>
      <table class="w-full bg-white shadow rounded-lg overflow-hidden">
        <thead><tr><th class="p-2 text-left">Name</th><th class="p-2">ELO</th><th class="p-2">Matches</th><th class="p-2">Actions</th></tr></thead>
        <tbody id="playerTable"></tbody>
      </table>
    </section>

    <!-- Matches -->
    <section id="matches" class="section">
      <h2 class="text-xl font-semibold mb-4">Matches</h2>
      <div class="mb-4">
        <button data-mode="1v1" class="mode-btn bg-blue-500 text-white px-3 py-1 rounded">1v1</button>
        <button data-mode="2v2" class="mode-btn bg-gray-300 text-gray-700 px-3 py-1 rounded">2v2</button>
      </div>
      <div id="form1v1" class="match-form">
        <div class="flex space-x-2 mb-2">
          <select id="selA1" class="border p-2 rounded flex-grow"></select>
          <select id="selB1" class="border p-2 rounded flex-grow"></select>
        </div>
        <div class="flex space-x-2 mb-2">
          <input id="scoreA1" type="number" class="border p-2 rounded w-24" placeholder="Score A"/>
          <input id="scoreB1" type="number" class="border p-2 rounded w-24" placeholder="Score B"/>
        </div>
        <div class="flex items-center space-x-4">
          <button id="reg1v1" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">Register</button>
          <button id="undoMatch" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition" disabled>Undo</button>
        </div>
      </div>
      <div id="form2v2" class="match-form hidden">
        <!-- 2v2 form to be styled similarly -->
      </div>
    </section>

    <!-- Leaderboard -->
    <section id="leaderboard" class="section">
      <h2 class="text-xl font-semibold mb-4">Leaderboard</h2>
      <input id="lbSearch" class="border p-2 rounded mb-4 w-full focus:ring focus:border-blue-300" placeholder="Search..."/>
      <table class="w-full bg-white shadow rounded-lg overflow-hidden">
        <thead><tr><th class="p-2">#</th><th class="p-2 text-left">Name</th><th class="p-2">ELO</th></tr></thead>
        <tbody id="lbTable"></tbody>
      </table>
    </section>

    <!-- Achievements -->
    <section id="achievements" class="section">
      <h2 class="text-xl font-semibold mb-4">Achievements</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <!-- achievement cards -->
      </div>
    </section>

    <!-- Stats -->
    <section id="stats" class="section">
      <h2 class="text-xl font-semibold mb-4">Player Stats & Achievements</h2>
      <select id="statsPlayerSelect" class="border p-2 rounded mb-4 focus:ring focus:border-blue-300">
        <option value="">Select player</option>
      </select>
      <div id="profile" class="space-y-6"></div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="bg-white shadow text-center py-4">
    &copy; 2025 Table‑Soccer ELO • v1.0 • <a href="#" class="text-blue-600 hover:underline">Support</a>
  </footer>

  <!-- Firebase + App Logic -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getDatabase, ref, onValue, push, update, remove } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyAX2LLZYbQuWFrDuU0-_guXpyZW9FMfVD6I",
      authDomain: "bordfodbolddtu.firebaseapp.com",
      databaseURL: "https://bordfodbolddtu-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "bordfodbolddtu",
      storageBucket: "bordfodbolddtu.appspot.com",
      messagingSenderId: "993863941891",
      appId: "1:993863941891:web:24c5c2408d254ad6d0f336"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    let players = {}, matches = {}, lastMatchKey = null, lastUpdates = null;

    // Toast helper
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    onValue(ref(db, 'players'), snap => { players = snap.val()||{}; rerender(); });
    onValue(ref(db, 'matches'), snap => { matches = snap.val()||{}; rerender(); });

    function rerender(){
      const pArr = Object.values(players);
      // Dashboard
      document.getElementById('totalPlayers').textContent = pArr.length;
      document.getElementById('matchesWeek').textContent = Object.values(matches).filter(m=>m.date>Date.now()-7*864e5).length;
      document.getElementById('averageElo').textContent = pArr.length?Math.round(pArr.reduce((s,p)=>s+p.elo,0)/pArr.length):0;
      document.getElementById('pendingAch').textContent = 0;
      
      // Players table
      const pf = document.getElementById('playerSearch').value.toLowerCase();
      const tbodyP = document.getElementById('playerTable'); tbodyP.innerHTML = '';
      pArr.filter(p=>p.name.toLowerCase().includes(pf)).forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${p.name}</td>
          <td class="p-2 text-center">${p.elo}</td>
          <td class="p-2 text-center">${p.wins+p.draws+p.losses}</td>
          <td class="p-2 text-center">
            <button data-id="${p.id}" class="delete-btn text-red-500 hover:underline text-sm">Delete</button>
          </td>`;
        tbodyP.appendChild(tr);
      });
      document.querySelectorAll('.delete-btn').forEach(b=>b.onclick=()=>{
        if(confirm('Delete this player?')){ remove(ref(db,'players/'+b.dataset.id)); showToast('Player removed'); }
      });

      // Leaderboard
      const lf = document.getElementById('lbSearch').value.toLowerCase();
      const tbodyL=document.getElementById('lbTable'); tbodyL.innerHTML='';
      pArr.filter(p=>p.name.toLowerCase().includes(lf)).sort((a,b)=>b.elo-a.elo).forEach((p,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td class="p-2 text-center">${i+1}</td><td class="p-2">${p.name}</td><td class="p-2 text-center">${p.elo}</td>`;
        tbodyL.appendChild(tr);
      });

      // Selects
      ['selA1','selB1','statsPlayerSelect'].forEach(id=>{
        const sel = document.getElementById(id); sel.innerHTML='';
        if(id==='statsPlayerSelect') sel.innerHTML='<option value="">Select player</option>';
        else sel.innerHTML='<option value="">--</option>';
        pArr.forEach((p,i)=> sel.innerHTML+=`<option value="${i}">${p.name} (${p.elo})</option>`);
      });

      // Undo availability
      document.getElementById('undoMatch').disabled = !lastMatchKey;
    }

    // Add player
    document.getElementById('addPlayer').onclick=()=>{
      const name=document.getElementById('newName').value.trim();
      const elo=+document.getElementById('newElo').value||100;
      if(!name) return alert('Enter a name');
      const newRef=push(ref(db,'players'));
      update(ref(db),{['players/'+newRef.key]:{id:newRef.key,name,elo,wins:0,draws:0,losses:0,goalsFor:0,goalsAgainst:0,currentStreak:0,maxStreak:0,cleanSheets:0,history:{[Date.now()]:elo}}})
        .then(()=>showToast('Player added'));
      document.getElementById('newName').value='';
    };

    // Register 1v1
    document.getElementById('reg1v1').onclick=()=>{
      const ai=+document.getElementById('selA1').value, bi=+document.getElementById('selB1').value;
      const sA=+document.getElementById('scoreA1').value, sB=+document.getElementById('scoreB1').value;
      const pArr=Object.values(players);
      if(isNaN(ai)||isNaN(bi)||ai===bi) return alert('Pick two distinct players');
      const pA={...pArr[ai]}, pB={...pArr[bi]};
      // stats + elo calculation (as before)
      // batch updates
      lastUpdates=updates; lastMatchKey=matchRef.key;
      update(ref(db),updates).then(()=>{showToast('Match recorded'); document.getElementById('undoMatch').disabled=false;});
    };

    // Undo match
    document.getElementById('undoMatch').onclick=()=>{
      if(!lastMatchKey) return;
      // simple remove match (players revert on next realtime fetch)
      remove(ref(db,'matches/'+lastMatchKey)).then(()=>{
        lastMatchKey=null; lastUpdates=null;
        showToast('Last match undone');
      });
    };

    // Tab nav
    document.querySelectorAll('.nav-btn').forEach(b=>b.onclick=()=>{
      document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById(b.dataset.target).classList.add('active');
    });

    // Mode switch
    document.querySelectorAll('.mode-btn').forEach(b=>b.onclick=()=>{
      document.querySelectorAll('.mode-btn').forEach(x=>x.className=x.className.replace('bg-blue-500 text-white','bg-gray-300 text-gray-700'));
      b.className='mode-btn bg-blue-500 text-white px-3 py-1 rounded';
      document.querySelectorAll('.match-form').forEach(f=>f.classList.add('hidden'));
      document.getElementById(b.dataset.mode==='1v1'?'form1v1':'form2v2').classList.remove('hidden');
    });

    // Stats tab
    document.getElementById('statsPlayerSelect').onchange=()=>{
      const idx=+document.getElementById('statsPlayerSelect').value;
      const prof=document.getElementById('profile'); prof.innerHTML='';
      if(isNaN(idx)) return;
      const p=Object.values(players)[idx]; const d=computePlayerData(p);
      // render stats & badges (as before)
    };

    // Compute data helper (keep original)
    function computePlayerData(p){ /* ... */ }

    // Initial render
    rerender();
  </script>
</body>
</html>
